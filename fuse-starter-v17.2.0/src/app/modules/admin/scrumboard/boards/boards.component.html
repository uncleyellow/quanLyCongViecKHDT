<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto" cdkScrollable>

    <!-- Main -->
    <div class="flex flex-col flex-auto items-center p-6 sm:p-10">

        <!-- Title -->
        <div class="mt-4 md:mt-24 text-3xl md:text-6xl font-extrabold tracking-tight leading-7 sm:leading-10">
            Các bảng công việc hàng ngày
        </div>

        <!-- Manager/Boss View: Grouped by Staff -->
        <ng-container *ngIf="isManagerOrBoss && boardGroups.length > 0">
            <div class="w-full max-w-7xl mt-8 md:mt-16">
                <!-- Board Groups -->
                <ng-container *ngFor="let group of boardGroups; trackBy: trackByGroupFn">
                    <!-- Staff Group Header -->
                    <div class="mb-6">
                        <div class="flex items-center space-x-3 cursor-pointer" (click)="toggleBoardGroupCollapse(group)">
                            <!-- Collapse/Expand icon -->
                            <mat-icon class="text-primary transition-transform duration-200" 
                                [class.rotate-90]="!group.collapsed"
                                [svgIcon]="'heroicons_outline:chevron-right'">
                            </mat-icon>
                            <!-- Staff info -->
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full" [ngClass]="{
                                    'bg-green-500': group.isCurrentUser,
                                    'bg-blue-500': !group.isCurrentUser
                                }"></div>
                                <h3 class="text-xl font-semibold" [ngClass]="{
                                    'text-primary': group.isCurrentUser,
                                    'text-gray-700': !group.isCurrentUser
                                }">
                                    {{group.staffName}}
                                    <span *ngIf="group.isCurrentUser" class="text-sm text-gray-500">(Bạn)</span>
                                </h3>
                                <span class="text-sm text-gray-500">({{group.boards.length}} boards)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Boards in this group -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"
                        cdkDropList [cdkDropListData]="group.boards" [cdkDropListOrientation]="'mixed'"
                        (cdkDropListDropped)="boardDropped($event)"
                        *ngIf="!group.collapsed">
                        
                        <!-- Drag placeholder -->
                        <div *cdkDropListPlaceholder
                            class="w-[224px] h-48 border-2 border-dashed border-blue-400 rounded-lg bg-blue-50 flex items-center justify-center transition-all duration-200">
                            <div class="text-blue-600 text-sm font-medium flex items-center">
                                <mat-icon class="mr-2 text-blue-500">drag_indicator</mat-icon>
                                Thả board vào đây
                            </div>
                        </div>

                        <ng-container *ngFor="let board of group.boards; trackBy: trackByFn">
                            <a class="flex flex-col items-start p-6 rounded-lg shadow bg-card rounded-lg hover:shadow-xl transition-shadow duration-150 ease-in-out board-card board-item relative"
                                [routerLink]="[board.id]" cdkDrag>
                                <!-- Drag handle -->
                                <div class="drag-handle absolute top-2 right-2" cdkDragHandle>
                                    <mat-icon class="text-gray-400 hover:text-gray-600">drag_indicator</mat-icon>
                                </div>
                                <div
                                    class="flex items-center justify-center p-3 rounded-full bg-primary-50 text-primary-700 dark:bg-primary dark:text-on-primary">
                                    <mat-icon class="text-current" [svgIcon]="board.icon"></mat-icon>
                                </div>
                                <!-- Title -->
                                <div class="mt-3 text-lg font-medium leading-5 line-clamp-1">{{board.title}}</div>
                                <!-- Description -->
                                <div class="mt-1 line-clamp-2 text-secondary text-sm">{{board.description}}</div>
                                <!-- Members -->
                                <ng-container *ngIf="board.members?.length">
                                    <div class="w-8 h-0.5 mt-3 border-t-2"></div>
                                    <div class="flex items-center mt-3 -space-x-1">
                                        <ng-container *ngFor="let member of board.members.slice(0, 4); trackBy: trackByFn">
                                            <img class="flex-0 w-6 h-6 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent object-cover"
                                                [src]="member.avatar" alt="Member avatar">
                                        </ng-container>
                                        <ng-container *ngIf="board.members.length > 4">
                                            <div
                                                class="flex flex-0 items-center justify-center w-6 h-6 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent bg-gray-200 text-gray-500">
                                                <div class="text-xs font-semibold">
                                                    +{{ board.members.slice(4).length }}
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <!-- Last activity -->
                                <div class="flex items-center mt-auto text-xs">
                                    <div class="text-secondary">Edited:</div>
                                    <div class="ml-1">{{formatDateAsRelative(board.lastActivity)}}</div>
                                </div>

                                <button mat-stroked-button color="primary" class="mt-2 w-full" (click)="openShareDialog(board)">
                                    <mat-icon>share</mat-icon> Chia sẻ
                                </button>
                            </a>
                        </ng-container>
                    </div>
                </ng-container>
            </div>
        </ng-container>

        <!-- Staff View: Regular Grid -->
        <ng-container *ngIf="!isManagerOrBoss || boardGroups.length === 0">
            <!-- Boards Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-8 md:mt-16 w-full max-w-7xl"
                cdkDropList [cdkDropListData]="boards" [cdkDropListOrientation]="'mixed'"
                (cdkDropListDropped)="boardDropped($event)">

                <!-- Drag placeholder -->
                <div *cdkDropListPlaceholder
                    class="w-[224px] h-48 border-2 border-dashed border-blue-400 rounded-lg bg-blue-50 flex items-center justify-center transition-all duration-200">
                    <div class="text-blue-600 text-sm font-medium flex items-center">
                        <mat-icon class="mr-2 text-blue-500">drag_indicator</mat-icon>
                        Thả board vào đây
                    </div>
                </div>

                <ng-container *ngFor="let board of boards; trackBy: trackByFn">
                    <a class="flex flex-col items-start  p-6 rounded-lg shadow bg-card rounded-lg hover:shadow-xl transition-shadow duration-150 ease-in-out board-card board-item relative"
                        [routerLink]="[board.id]" cdkDrag>
                        <!-- Drag handle -->
                        <div class="drag-handle absolute top-2 right-2" cdkDragHandle>
                            <mat-icon class="text-gray-400 hover:text-gray-600">drag_indicator</mat-icon>
                        </div>
                        <div
                            class="flex items-center justify-center p-3 rounded-full bg-primary-50 text-primary-700 dark:bg-primary dark:text-on-primary">
                            <mat-icon class="text-current" [svgIcon]="board.icon"></mat-icon>
                        </div>
                        <!-- Title -->
                        <div class="mt-3 text-lg font-medium leading-5 line-clamp-1">{{board.title}}</div>
                        <!-- Description -->
                        <div class="mt-1 line-clamp-2 text-secondary text-sm">{{board.description}}</div>
                        <!-- Members -->
                        <ng-container *ngIf="board.members?.length">
                            <div class="w-8 h-0.5 mt-3 border-t-2"></div>
                            <div class="flex items-center mt-3 -space-x-1">
                                <ng-container *ngFor="let member of board.members.slice(0, 4); trackBy: trackByFn">
                                    <img class="flex-0 w-6 h-6 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent object-cover"
                                        [src]="member.avatar" alt="Member avatar">
                                </ng-container>
                                <ng-container *ngIf="board.members.length > 4">
                                    <div
                                        class="flex flex-0 items-center justify-center w-6 h-6 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent bg-gray-200 text-gray-500">
                                        <div class="text-xs font-semibold">
                                            +{{ board.members.slice(4).length }}
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                        <!-- Last activity -->
                        <div class="flex items-center mt-auto text-xs">
                            <div class="text-secondary">Edited:</div>
                            <div class="ml-1">{{formatDateAsRelative(board.lastActivity)}}</div>
                        </div>

                        <button mat-stroked-button color="primary" class="mt-2 w-full" (click)="openShareDialog(board)">
                            <mat-icon>share</mat-icon> Chia sẻ
                        </button>
                    </a>
                </ng-container>
            </div>
        </ng-container>

        <!-- New board -->
        <div class="flex flex-col items-center justify-center w-full h-48 rounded-lg cursor-pointer border-2 border-gray-300 border-dashed hover:bg-hover transition-colors duration-150 ease-in-out"
            (click)="createNewBoard()">
            <mat-icon class="icon-size-12 text-hint" [svgIcon]="'heroicons_outline:plus'"></mat-icon>
        </div>
    </div>

</div>